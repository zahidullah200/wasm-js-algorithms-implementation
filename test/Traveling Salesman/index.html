<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebAssembly vs JavaScript (Traveling Salesman Problem)</title>
</head>
<body>

    <div class="container">
        <h1>WebAssembly vs JavaScript (Traveling Salesman Problem)</h1>

        <label for="methodSelect">Select Method:</label>
        <select id="methodSelect">
            <option value="wasm">WebAssembly</option>
            <option value="js">JavaScript</option>
        </select>

        <button id="runTestButton">Run Test</button>

        <div id="result" class="result">
            <h2>Result:</h2>
            <p>Method: <span id="method"></span></p>
            <p>Result: <span id="resultValue"></span></p>
            <p>Time taken: <span id="timeTaken"></span></p>
            <p>Time Complexity: <span id="timeComplexity"></span></p>
        </div>
    </div>

    <script>
        const N = 6; // Adjust for the number of cities

        // Function to calculate the distance between two cities
        function getDistance(city1, city2, distances) {
            return distances[city1 * N + city2];
        }
        
        // Function to swap two elements in an array
        function swap(arr, i, j) {
            const temp = arr[i];
            arr[i] = arr[j];
            arr[j] = temp;
        }
        
        // Function to calculate factorial
        function factorial(n) {
            if (n <= 1) return 1;
            return n * factorial(n - 1);
        }
        
        // Function to generate all permutations of the given array
        function permute(arr, start, end, distances, minDistance, minPath) {
            if (start === end) {
                let distance = 0;
                for (let i = 0; i < arr.length - 1; i++) {
                    distance += getDistance(arr[i], arr[i + 1], distances);
                }
                if (distance < minDistance[0]) {
                    minDistance[0] = distance;
                    minPath.splice(0, minPath.length, ...arr);
                }
            } else {
                for (let i = start; i <= end; i++) {
                    swap(arr, start, i);
                    permute(arr, start + 1, end, distances, minDistance, minPath);
                    swap(arr, start, i); // backtrack
                }
            }
        }
        
        // Function to solve TSP using brute force
        function solveTSP(distances) {
            const cities = Array.from({ length: N }, (_, i) => i); // Generate array of cities
            const minDistance = [Number.MAX_SAFE_INTEGER];
            const minPath = [];
        
            permute(cities, 0, cities.length - 1, distances, minDistance, minPath);
        
            return { distance: minDistance[0], path: minPath };
        }
        
        document.addEventListener("DOMContentLoaded", () => {
            const runTestButton = document.getElementById("runTestButton");
            runTestButton.addEventListener("click", runTest);
        });
        
        async function runTest() {
            const methodSelect = document.getElementById("methodSelect");
            const selectedMethod = methodSelect.value;
        
            if (selectedMethod === "wasm") {
                await solveTSPWithWasm();
            } else if (selectedMethod === "js") {
                const result = solveTSPWithJs();
                const time = 0;
                displayResult("JavaScript", JSON.stringify(result), time, "O(n!)");
            }
        }
        
        async function solveTSPWithWasm() {
            try {
                const response = await fetch("traveling.wasm");
                if (!response.ok) {
                    throw new Error("Failed to fetch WebAssembly module: " + response.statusText);
                }
        
                const bytes = await response.arrayBuffer();
                const result = await WebAssembly.instantiate(bytes, {
                    env: {
                        memory: new WebAssembly.Memory({ initial: 256, maximum: 256 }),
                        __memory_base: 0,
                        __table_base: 0,
                        memoryBase: 0,
                        tableBase: 0,
                        emscripten_resize_heap: () => {},
                        emscripten_memcpy_big: () => {},
                        emscripten_get_sbrk_ptr: () => {},
                        emscripten_check_blocking_allowed: () => {},
                        abortStackOverflow: () => {},
                        _abort: () => {},
                        emscripten_memcpy_js: (dest, source, num) => {
                            new Uint8Array(memory.buffer).copyWithin(dest, source, source + num);
                            return dest;
                        }
                    }
                });
        
                const memory = new Uint32Array(result.instance.exports.memory.buffer);
        
                const allocateResult = result.instance.exports.allocateResult;
                const solveTSP = result.instance.exports.solveTSP;
                const freeResult = result.instance.exports.freeResult;
        
                const pathPtr = allocateResult(N);
                const path = new Int32Array(memory.buffer, pathPtr, N + 1);
        
                solveTSP(N);
        
                const resultArray = Array.from(path.slice(0, N + 1));
                freeResult();
        
                displayResult("WebAssembly", resultArray.join(", "), 0, "O(n!)");
            } catch (error) {
                console.error("Error loading WebAssembly module:", error);
            }
        }
        
        function solveTSPWithJs() {
            const distances = [
                0, 10, 15, 20, 44, 34,
                10, 0, 35, 25, 45, 65,
                15, 35, 0, 30, 35, 66,
                20, 25, 30, 0, 86, 56,
                45, 5, 56, 67, 87, 98,
                678, 7698, 8, 7, 5, 6
            ];
            return solveTSP(distances);
        }
        
        function displayResult(method, result, time, complexity) {
            const methodElement = document.getElementById("method");
            const resultElement = document.getElementById("resultValue");
            const timeTakenElement = document.getElementById("timeTaken");
            const complexityElement = document.getElementById("timeComplexity");
        
            methodElement.textContent = method;
            resultElement.textContent = result;
            timeTakenElement.textContent = time + " ms";
            complexityElement.textContent = complexity;
        }
        
    </script>
    
</body>
</html>
